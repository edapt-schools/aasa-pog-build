import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useEffect, useRef } from 'react';
import { X, Copy, ExternalLink, Loader2 } from 'lucide-react';
import { Button } from './ui/button';
import { Badge } from './ui/badge';
import { Card, CardHeader, CardContent } from './ui/card';
import { KeywordScoreCard } from './KeywordScoreCard';
import { DocumentList } from './DocumentList';
import { useDistrictDetail } from '../hooks/useDistrictDetail';
import { useDistrictDocuments } from '../hooks/useDistrictDocuments';
export function DistrictDetailPanel({ ncesId, onClose }) {
    const [activeTab, setActiveTab] = useState('overview');
    const panelRef = useRef(null);
    const { data: detailData, loading: detailLoading, error: detailError } = useDistrictDetail(ncesId);
    const { data: documentsData, loading: docsLoading, error: docsError } = useDistrictDocuments(ncesId);
    // ESC key to close
    useEffect(() => {
        const handleEsc = (e) => {
            if (e.key === 'Escape') {
                onClose();
            }
        };
        document.addEventListener('keydown', handleEsc);
        return () => document.removeEventListener('keydown', handleEsc);
    }, [onClose]);
    // Focus management - focus panel when opened
    useEffect(() => {
        if (panelRef.current) {
            panelRef.current.focus();
        }
    }, []);
    // Copy to clipboard helper
    const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text);
        // TODO: Add toast notification
    };
    const district = detailData?.district;
    const keywordScores = detailData?.keywordScores;
    const documents = documentsData?.data || [];
    return (_jsxs(_Fragment, { children: [_jsx("div", { className: "fixed inset-0 bg-black/50 backdrop-blur-sm z-40", onClick: onClose, "aria-hidden": "true" }), _jsxs("div", { ref: panelRef, className: "fixed right-0 top-0 h-full w-full sm:w-4/5 lg:w-3/5 bg-background border-l border-border z-50 overflow-y-auto transform transition-transform duration-300 shadow-2xl", role: "dialog", "aria-modal": "true", "aria-labelledby": "panel-title", tabIndex: -1, children: [_jsxs("div", { className: "sticky top-0 bg-background border-b border-border z-10", children: [_jsxs("div", { className: "flex items-center justify-between p-4", children: [_jsx("div", { className: "flex-1 min-w-0", children: detailLoading ? (_jsx("div", { className: "h-6 w-48 bg-muted rounded animate-pulse" })) : (_jsx("h2", { id: "panel-title", className: "text-xl font-semibold text-foreground truncate", children: district?.name })) }), _jsx(Button, { variant: "ghost", size: "sm", onClick: onClose, "aria-label": "Close panel", children: _jsx(X, { className: "h-5 w-5" }) })] }), _jsxs("div", { className: "flex border-t border-border", children: [_jsx("button", { className: `flex-1 px-4 py-3 text-sm font-medium transition-colors ${activeTab === 'overview'
                                            ? 'text-foreground border-b-2 border-accent'
                                            : 'text-muted-foreground hover:text-foreground'}`, onClick: () => setActiveTab('overview'), role: "tab", "aria-selected": activeTab === 'overview', children: "Overview" }), _jsxs("button", { className: `flex-1 px-4 py-3 text-sm font-medium transition-colors ${activeTab === 'documents'
                                            ? 'text-foreground border-b-2 border-accent'
                                            : 'text-muted-foreground hover:text-foreground'}`, onClick: () => setActiveTab('documents'), role: "tab", "aria-selected": activeTab === 'documents', children: ["Documents", documentsData && documentsData.total > 0 && (_jsx(Badge, { variant: "secondary", className: "ml-2", children: documentsData.total }))] })] })] }), _jsxs("div", { className: "p-6 space-y-6", children: [detailLoading && (_jsx("div", { className: "flex items-center justify-center py-12", children: _jsx(Loader2, { className: "h-8 w-8 animate-spin text-muted-foreground" }) })), detailError && (_jsx(Card, { className: "bg-destructive/10 border-destructive", children: _jsxs(CardContent, { className: "p-4", children: [_jsx("p", { className: "text-sm text-destructive", children: detailError }), _jsx(Button, { variant: "outline", size: "sm", onClick: () => window.location.reload(), className: "mt-3", children: "Retry" })] }) })), activeTab === 'overview' && district && (_jsxs(_Fragment, { children: [_jsxs(Card, { children: [_jsx(CardHeader, { className: "border-b border-border", children: _jsx("h3", { className: "text-lg font-semibold text-foreground", children: "District Information" }) }), _jsxs(CardContent, { className: "p-4 space-y-3", children: [_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Location" }), _jsxs("span", { className: "text-sm font-medium text-foreground", children: [district.city, ", ", district.state, " ", district.county && `(${district.county})`] })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "NCES ID" }), _jsx("span", { className: "text-sm font-medium text-foreground font-mono", children: district.ncesId })] }), district.enrollment && (_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Enrollment" }), _jsxs("span", { className: "text-sm font-medium text-foreground", children: [district.enrollment.toLocaleString(), " students"] })] })), district.gradesServed && (_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Grades Served" }), _jsx("span", { className: "text-sm font-medium text-foreground", children: district.gradesServed })] })), district.frplPercent && (_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "FRPL %" }), _jsxs("span", { className: "text-sm font-medium text-foreground", children: [parseFloat(district.frplPercent).toFixed(1), "%"] })] })), district.minorityPercent && (_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Minority %" }), _jsxs("span", { className: "text-sm font-medium text-foreground", children: [parseFloat(district.minorityPercent).toFixed(1), "%"] })] })), district.localeCode && (_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Locale" }), _jsx("span", { className: "text-sm font-medium text-foreground", children: district.localeCode })] }))] })] }), (district.superintendentName || district.superintendentEmail || district.phone) && (_jsxs(Card, { children: [_jsx(CardHeader, { className: "border-b border-border", children: _jsx("h3", { className: "text-lg font-semibold text-foreground", children: "Superintendent Contact" }) }), _jsxs(CardContent, { className: "p-4 space-y-3", children: [district.superintendentName && (_jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Name" }), _jsx("span", { className: "text-sm font-medium text-foreground", children: district.superintendentName })] })), district.superintendentEmail && (_jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Email" }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("a", { href: `mailto:${district.superintendentEmail}`, className: "text-sm text-blue-600 dark:text-blue-400 hover:underline", children: district.superintendentEmail }), _jsx(Button, { variant: "ghost", size: "sm", onClick: () => copyToClipboard(district.superintendentEmail), "aria-label": "Copy email", children: _jsx(Copy, { className: "h-3 w-3" }) })] })] })), district.phone && (_jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Phone" }), _jsx("a", { href: `tel:${district.phone}`, className: "text-sm text-foreground hover:underline", children: district.phone })] })), district.address && (_jsxs("div", { className: "flex justify-between items-start", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Address" }), _jsx("span", { className: "text-sm text-foreground text-right max-w-xs", children: district.address })] })), district.websiteDomain && (_jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "text-sm text-muted-foreground", children: "Website" }), _jsxs("a", { href: `https://${district.websiteDomain}`, target: "_blank", rel: "noopener noreferrer", className: "text-sm text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center gap-1", children: [district.websiteDomain, _jsx(ExternalLink, { className: "h-3 w-3" })] })] }))] })] })), keywordScores && (_jsx(KeywordScoreCard, { scores: keywordScores, showDetails: true }))] })), activeTab === 'documents' && (_jsxs(_Fragment, { children: [docsLoading && (_jsx("div", { className: "flex items-center justify-center py-12", children: _jsx(Loader2, { className: "h-8 w-8 animate-spin text-muted-foreground" }) })), docsError && (_jsx(Card, { className: "bg-destructive/10 border-destructive", children: _jsx(CardContent, { className: "p-4", children: _jsx("p", { className: "text-sm text-destructive", children: docsError }) }) })), !docsLoading && !docsError && _jsx(DocumentList, { documents: documents })] }))] })] })] }));
}
